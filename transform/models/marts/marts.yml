models:
  - name: fct_line_movements
    description: "Snapshot level odds data. Each row represents one odds observation for a game/sportsbook/market/outcome, with the change from the previous snapshot."
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - event_id
            - sportsbook
            - market_type
            - outcome
            - captured_at
    columns:
      - name: nfl_week
        description: "NFL week number. 1-18 for regular season, 19 Wild Card, 20 Divisional, 21 Conference Championships, 22 Super Bowl."
      - name: prev_line
        description: "Line value from the previous snapshot for the same game/sportsbook/market/outcome"
      - name: line_change
        description: "Movement in the line since the previous snapshot (line minus prev_line)"
      - name: price
        description: "Odds price in American format"
      - name: prev_price
        description: "Price from the previous snapshot for the same game/sportsbook/market/outcome"
      - name: price_change
        description: "Change in price since the previous snapshot (price minus prev_price)"
      - name: implied_prob
        description: "Market implied probability from American odds. Does not remove vig."

  - name: fct_game_summary
    description: "Game level summary with one row per game/sportsbook/market/outcome. Compares opening and closing lines, prices, and implied probabilities."
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - event_id
            - sportsbook
            - market_type
            - outcome
    columns:
      - name: nfl_week
        description: "NFL week number. 1-18 for regular season, 19-22 for postseason."
      - name: total_line_movement
        description: "Net line movement from open to close (closing_line minus opening_line)"
      - name: opening_implied_prob_pct
        description: "Implied probability at market open, derived from opening price"
      - name: closing_implied_prob_pct
        description: "Implied probability at market close, derived from closing price"
      - name: implied_prob_pct_change
        description: "Change in implied probability from open to close"

  - name: fct_season_summary
    description: "Season level summary with one row per game/market/outcome, using Pinnacle as the consensus reference. Used for cross-game analysis."
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - event_id
            - market_type
            - outcome
    columns:
      - name: event_id
        data_tests:
          - not_null
      - name: market_type
        data_tests:
          - not_null
          - accepted_values:
              values: ['spreads', 'totals']
      - name: outcome
        data_tests:
          - not_null
      - name: total_line_movement
        data_tests:
          - not_null
      - name: abs_line_movement
        data_tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: days_of_data
        data_tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
